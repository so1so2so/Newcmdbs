# -*- coding: utf-8 -*-
from __future__ import unicode_literals
from rest_framework.views import APIView
from django.views.generic.base import View
from django.shortcuts import render, HttpResponse
from cmdb import models
from rest_framework.viewsets import ModelViewSet
from rest_framework.pagination import PageNumberPagination
from rest_framework.response import Response
from django.contrib import auth
from cmdb.serial import AssetSerializer
from cmdb.serial import ServerSerializer
from cmdb.base_ret_class.base import Ret_class
import uuid
from cmdb.auth.auth import Auth


from api.api2.Runner import ANSRunner
# from ansible.errors import AnsibleError


# from api.api2.Runner import ANSRunner

class GetAsset(ModelViewSet):
    queryset = models.Asset.objects.all()
    serializer_class = AssetSerializer
    pagination_class = PageNumberPagination


class GetServer(ModelViewSet):
    authentication_classes = [Auth, ]
    queryset = models.Server.objects.all()
    serializer_class = ServerSerializer
    pagination_class = PageNumberPagination


class Register(APIView):
    def get(self, request, *args, **kwargs):
        # return render(request, '/static/index.html')
        return HttpResponse("ok")


class Login(APIView):

    def get(self, request, *args, **kwargs):
        # return render(request, '/static/index.html')
        print request.session.session_key
        return HttpResponse("ok")

    def post(self, request, *args, **kwargs):
        d = Ret_class()
        token = uuid.uuid4().hex
        username = request.data['username']
        pwd = request.data['password']
        print username, pwd
        # 如何判断用户名和密码对不对
        user = auth.authenticate(username=username, password=pwd)
        print user
        if user:
            models.Token.objects.update_or_create(user=user, defaults={'token': token})
            # ret = user.is_authenticated()
            auth.login(request, user)
            d.code = 200
            d.message = '登录成功'
            d.token = token
            return Response(d.__dict__)
        else:
            d.code = 404
            d.message = '登录失败,请检查用户名密码'
            d.token = None
            return Response(d.__dict__)


class ansible_playbook(APIView):
    def get(self, request, *args, **kwargs):
        d1 ={u'failed': {}, u'success': {u'192_168_43_61': {u'_ansible_parsed': True, u'_ansible_no_log': False, u'changed': False, u'_ansible_verbose_override': True, u'invocation': {u'module_args': {u'filter': u'*', u'gather_subset': [u'all'], u'fact_path': u'/etc/ansible/facts.d', u'gather_timeout': 10}}, u'ansible_facts': {u'module_setup': True, u'ansible_distribution_version': u'7.4.1708', u'ansible_distribution_file_variety': u'RedHat', u'ansible_env': {u'LANG': u'zh_CN.UTF-8', u'TERM': u'vt100', u'SHELL': u'/bin/bash', u'XDG_RUNTIME_DIR': u'/run/user/0', u'MAIL': u'/var/mail/root', u'SHLVL': u'2', u'SSH_TTY': u'/dev/pts/0', u'SSH_CLIENT': u'192.168.43.50 47762 22', u'LESSOPEN': u'||/usr/bin/lesspipe.sh %s', u'PWD': u'/root', u'LOGNAME': u'root', u'USER': u'root', u'PATH': u'/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin', u'HOME': u'/root', u'LS_COLORS': u'rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:*.xspf=01;36:', u'XDG_SESSION_ID': u'131', u'_': u'/usr/bin/python', u'SSH_CONNECTION': u'192.168.43.50 47762 192.168.43.61 22'}, u'ansible_userspace_bits': u'64', u'ansible_architecture': u'x86_64', u'ansible_default_ipv4': {u'macaddress': u'00:0c:29:c7:8e:2a', u'network': u'192.168.43.0', u'mtu': 1500, u'broadcast': u'192.168.43.255', u'alias': u'ens33', u'netmask': u'255.255.255.0', u'address': u'192.168.43.61', u'interface': u'ens33', u'type': u'ether', u'gateway': u'192.168.43.1'}, u'ansible_swapfree_mb': 2004, u'ansible_default_ipv6': {}, u'ansible_cmdline': {u'LANG': u'zh_CN.UTF-8', u'BOOT_IMAGE': u'/vmlinuz-4.14.13-1.el7.elrepo.x86_64', u'quiet': True, u'rhgb': True, u'rd.lvm.lv': u'centos/swap', u'crashkernel': u'auto', u'ro': True, u'root': u'/dev/mapper/centos-root'}, u'ansible_selinux': {u'status': u'disabled'}, u'ansible_userspace_architecture': u'x86_64', u'ansible_product_uuid': u'461E4D56-D008-B68B-904C-7410F0C78E2A', u'ansible_pkg_mgr': u'yum', u'ansible_distribution': u'CentOS', u'ansible_iscsi_iqn': u'', u'ansible_all_ipv6_addresses': [u'fe80::c42f:bdff:feac:8063', u'fe80::42:53ff:fe86:d4f9', u'fe80::a52a:2fd:bf5c:2e17', u'fe80::ba80:900d:f950:817e', u'fe80::ec43:48ff:fe1b:1bd0'], u'ansible_uptime_seconds': 436084, u'ansible_kernel': u'4.14.13-1.el7.elrepo.x86_64', u'ansible_system_capabilities_enforced': u'True', u'ansible_python': {u'executable': u'/usr/bin/python', u'version': {u'micro': 5, u'major': 2, u'releaselevel': u'final', u'serial': 0, u'minor': 7}, u'type': u'CPython', u'has_sslcontext': True, u'version_info': [2, 7, 5, u'final', 0]}, u'ansible_is_chroot': False, u'ansible_user_shell': u'/bin/bash', u'ansible_product_serial': u'VMware-56 4d 1e 46 08 d0 8b b6-90 4c 74 10 f0 c7 8e 2a', u'ansible_form_factor': u'Other', u'ansible_distribution_file_parsed': True, u'ansible_fips': False, u'ansible_user_id': u'root', u'ansible_selinux_python_present': True, u'ansible_local': {}, u'ansible_processor_vcpus': 2, u'ansible_docker0': {u'macaddress': u'02:42:53:86:d4:f9', u'features': {u'tx_checksum_ipv4': u'off [fixed]', u'generic_receive_offload': u'on', u'tx_checksum_ipv6': u'off [fixed]', u'tx_scatter_gather_fraglist': u'on', u'rx_all': u'off [fixed]', u'highdma': u'on', u'rx_fcs': u'off [fixed]', u'tx_lockless': u'on [fixed]', u'tx_tcp_ecn_segmentation': u'on', u'rx_udp_tunnel_port_offload': u'off [fixed]', u'esp_hw_offload': u'off [fixed]', u'tx_gso_robust': u'off [requested on]', u'tx_tcp_mangleid_segmentation': u'on', u'tx_ipxip4_segmentation': u'on', u'tx_checksumming': u'on', u'vlan_challenged': u'off [fixed]', u'loopback': u'off [fixed]', u'tx_ipxip6_segmentation': u'on', u'fcoe_mtu': u'off [fixed]', u'scatter_gather': u'on', u'tx_checksum_sctp': u'off [fixed]', u'tx_vlan_stag_hw_insert': u'on', u'rx_vlan_stag_hw_parse': u'off [fixed]', u'tx_gso_partial': u'on', u'rx_vlan_stag_filter': u'off [fixed]', u'large_receive_offload': u'off [fixed]', u'tx_scatter_gather': u'on', u'rx_checksumming': u'off [fixed]', u'tx_tcp_segmentation': u'on', u'netns_local': u'on [fixed]', u'tx_esp_segmentation': u'on', u'generic_segmentation_offload': u'on', u'tx_udp_tnl_segmentation': u'on', u'tcp_segmentation_offload': u'on', u'l2_fwd_offload': u'off [fixed]', u'rx_vlan_offload': u'off [fixed]', u'ntuple_filters': u'off [fixed]', u'tx_gre_csum_segmentation': u'on', u'esp_tx_csum_hw_offload': u'off [fixed]', u'tx_tcp6_segmentation': u'on', u'tx_udp_tnl_csum_segmentation': u'on', u'udp_fragmentation_offload': u'off', u'tx_sctp_segmentation': u'on', u'tx_checksum_fcoe_crc': u'off [fixed]', u'hw_tc_offload': u'off [fixed]', u'tx_checksum_ip_generic': u'on', u'tx_fcoe_segmentation': u'off [requested on]', u'tx_nocache_copy': u'off', u'rx_vlan_filter': u'off [fixed]', u'tx_vlan_offload': u'on', u'receive_hashing': u'off [fixed]', u'tx_gre_segmentation': u'on'}, u'interfaces': [u'veth28f26f2'], u'id': u'8000.02425386d4f9', u'mtu': 1500, u'device': u'docker0', u'promisc': False, u'stp': False, u'ipv4': {u'broadcast': u'172.17.40.255', u'netmask': u'255.255.255.0', u'network': u'172.17.40.0', u'address': u'172.17.40.1'}, u'ipv6': [{u'scope': u'link', u'prefix': u'64', u'address': u'fe80::42:53ff:fe86:d4f9'}], u'active': True, u'timestamping': [u'rx_software', u'software'], u'type': u'bridge', u'hw_timestamp_filters': []}, u'ansible_processor': [u'0', u'GenuineIntel', u'Intel(R) Core(TM) i7-4702MQ CPU @ 2.20GHz', u'1', u'GenuineIntel', u'Intel(R) Core(TM) i7-4702MQ CPU @ 2.20GHz'], u'ansible_ssh_host_key_ecdsa_public': u'AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBL1ZvdAfFSXG/UUZyDxC7LsyX6VzvA9pt6basMlJaZU4IaIY7/SN6saZdU9tAhTOITXwI8l5d+rJ1BhZZK4+ZOY=', u'ansible_flannel.1': {u'macaddress': u'c6:2f:bd:ac:80:63', u'features': {u'tx_checksum_ipv4': u'off [fixed]', u'generic_receive_offload': u'on', u'tx_checksum_ipv6': u'off [fixed]', u'tx_scatter_gather_fraglist': u'off [fixed]', u'rx_all': u'off [fixed]', u'highdma': u'off [fixed]', u'rx_fcs': u'off [fixed]', u'tx_lockless': u'on [fixed]', u'tx_tcp_ecn_segmentation': u'on', u'rx_udp_tunnel_port_offload': u'off [fixed]', u'esp_hw_offload': u'off [fixed]', u'tx_gso_robust': u'off [fixed]', u'tx_tcp_mangleid_segmentation': u'on', u'tx_ipxip4_segmentation': u'off [fixed]', u'tx_checksumming': u'on', u'vlan_challenged': u'off [fixed]', u'loopback': u'off [fixed]', u'tx_ipxip6_segmentation': u'off [fixed]', u'fcoe_mtu': u'off [fixed]', u'scatter_gather': u'on', u'tx_checksum_sctp': u'off [fixed]', u'tx_vlan_stag_hw_insert': u'off [fixed]', u'rx_vlan_stag_hw_parse': u'off [fixed]', u'tx_gso_partial': u'off [fixed]', u'rx_vlan_stag_filter': u'off [fixed]', u'large_receive_offload': u'off [fixed]', u'tx_scatter_gather': u'on', u'rx_checksumming': u'on', u'tx_tcp_segmentation': u'on', u'netns_local': u'off [fixed]', u'tx_esp_segmentation': u'off [fixed]', u'generic_segmentation_offload': u'on', u'tx_udp_tnl_segmentation': u'off [fixed]', u'tcp_segmentation_offload': u'on', u'l2_fwd_offload': u'off [fixed]', u'rx_vlan_offload': u'off [fixed]', u'ntuple_filters': u'off [fixed]', u'tx_gre_csum_segmentation': u'off [fixed]', u'esp_tx_csum_hw_offload': u'off [fixed]', u'tx_tcp6_segmentation': u'on', u'tx_udp_tnl_csum_segmentation': u'off [fixed]', u'udp_fragmentation_offload': u'off', u'tx_sctp_segmentation': u'on', u'tx_checksum_fcoe_crc': u'off [fixed]', u'hw_tc_offload': u'off [fixed]', u'tx_checksum_ip_generic': u'on', u'tx_fcoe_segmentation': u'off [fixed]', u'tx_nocache_copy': u'off', u'rx_vlan_filter': u'off [fixed]', u'tx_vlan_offload': u'off [fixed]', u'receive_hashing': u'off [fixed]', u'tx_gre_segmentation': u'off [fixed]'}, u'hw_timestamp_filters': [], u'mtu': 1450, u'device': u'flannel.1', u'promisc': False, u'timestamping': [u'rx_software', u'software'], u'ipv4': {u'broadcast': u'global', u'netmask': u'255.255.255.255', u'network': u'172.17.101.0', u'address': u'172.17.101.0'}, u'ipv6': [{u'scope': u'link', u'prefix': u'64', u'address': u'fe80::c42f:bdff:feac:8063'}], u'active': True, u'type': u'ether'}, u'ansible_mounts': [{u'block_used': 1837701, u'uuid': u'8f3c327e-d407-4f58-8d01-b1fa4818f9ca', u'size_total': 50432839680, u'block_total': 12312705, u'mount': u'/', u'block_available': 10475004, u'size_available': 42905616384, u'fstype': u'xfs', u'inode_total': 24637440, u'options': u'rw,relatime,attr2,inode64,noquota', u'device': u'/dev/mapper/centos-root', u'inode_used': 143510, u'block_size': 4096, u'inode_available': 24493930}, {u'block_used': 39602, u'uuid': u'b65e3721-d929-4302-b924-db91f598874e', u'size_total': 1063256064, u'block_total': 259584, u'mount': u'/boot', u'block_available': 219982, u'size_available': 901046272, u'fstype': u'xfs', u'inode_total': 524288, u'options': u'rw,relatime,attr2,inode64,noquota', u'device': u'/dev/sda1', u'inode_used': 332, u'block_size': 4096, u'inode_available': 523956}], u'ansible_system_vendor': u'VMware, Inc.', u'ansible_swaptotal_mb': 2047, u'ansible_distribution_major_version': u'7', u'ansible_real_group_id': 0, u'ansible_lsb': {}, u'ansible_ens33': {u'macaddress': u'00:0c:29:c7:8e:2a', u'features': {u'tx_checksum_ipv4': u'off [fixed]', u'generic_receive_offload': u'on', u'tx_checksum_ipv6': u'off [fixed]', u'tx_scatter_gather_fraglist': u'off [fixed]', u'rx_all': u'off', u'highdma': u'off [fixed]', u'rx_fcs': u'off', u'tx_lockless': u'off [fixed]', u'tx_tcp_ecn_segmentation': u'off [fixed]', u'rx_udp_tunnel_port_offload': u'off [fixed]', u'esp_hw_offload': u'off [fixed]', u'tx_gso_robust': u'off [fixed]', u'tx_tcp_mangleid_segmentation': u'off', u'tx_ipxip4_segmentation': u'off [fixed]', u'tx_checksumming': u'on', u'vlan_challenged': u'off [fixed]', u'loopback': u'off [fixed]', u'tx_ipxip6_segmentation': u'off [fixed]', u'fcoe_mtu': u'off [fixed]', u'scatter_gather': u'on', u'tx_checksum_sctp': u'off [fixed]', u'tx_vlan_stag_hw_insert': u'off [fixed]', u'rx_vlan_stag_hw_parse': u'off [fixed]', u'tx_gso_partial': u'off [fixed]', u'rx_vlan_stag_filter': u'off [fixed]', u'large_receive_offload': u'off [fixed]', u'tx_scatter_gather': u'on', u'rx_checksumming': u'off', u'tx_tcp_segmentation': u'on', u'netns_local': u'off [fixed]', u'tx_esp_segmentation': u'off [fixed]', u'generic_segmentation_offload': u'on', u'tx_udp_tnl_segmentation': u'off [fixed]', u'tcp_segmentation_offload': u'on', u'l2_fwd_offload': u'off [fixed]', u'rx_vlan_offload': u'on', u'ntuple_filters': u'off [fixed]', u'tx_gre_csum_segmentation': u'off [fixed]', u'esp_tx_csum_hw_offload': u'off [fixed]', u'tx_tcp6_segmentation': u'off [fixed]', u'tx_udp_tnl_csum_segmentation': u'off [fixed]', u'udp_fragmentation_offload': u'off', u'tx_sctp_segmentation': u'off [fixed]', u'tx_checksum_fcoe_crc': u'off [fixed]', u'hw_tc_offload': u'off [fixed]', u'tx_checksum_ip_generic': u'on', u'tx_fcoe_segmentation': u'off [fixed]', u'tx_nocache_copy': u'off', u'rx_vlan_filter': u'on [fixed]', u'tx_vlan_offload': u'on [fixed]', u'receive_hashing': u'off [fixed]', u'tx_gre_segmentation': u'off [fixed]'}, u'type': u'ether', u'pciid': u'0000:02:01.0', u'module': u'e1000', u'mtu': 1500, u'device': u'ens33', u'promisc': False, u'timestamping': [u'tx_software', u'rx_software', u'software'], u'ipv4': {u'broadcast': u'192.168.43.255', u'netmask': u'255.255.255.0', u'network': u'192.168.43.0', u'address': u'192.168.43.61'}, u'ipv6': [{u'scope': u'link', u'prefix': u'64', u'address': u'fe80::a52a:2fd:bf5c:2e17'}], u'active': True, u'speed': 1000, u'hw_timestamp_filters': []}, u'ansible_machine': u'x86_64', u'ansible_ssh_host_key_rsa_public': u'AAAAB3NzaC1yc2EAAAADAQABAAABAQCWfSRLFTWJ5yDaz/lCI8P/bT6m9CW4oBtgWOk7rzBcuUrymY7PAi7UQOH/XbEjQOK2oOZZAIlMrKYRSMekwIJ/P5m7wwwuNpldsqfL0EoqxEPoSjpjQdarRrDTIiDRWaDWSBioYp2z5IxLFN3Pt2hpprAUNDi1+q4w7h5euLgBTx/exsAFHnflzjgZg+8uktmeDF+Fu5JyzmpLd7r3D5HVPq1AxIIekz60CuZn57nBAkF2IzGwdZXMwkhFHpRSjIziDStZk8ZIcFKGeT/B8Ful/UiNnUt1sqgbtvALqjJAr8PmMiTSjik5m+nBasK1GVXfUPLA9OnmKJuan2gep2/h', u'ansible_user_gecos': u'root', u'ansible_processor_threads_per_core': 1, u'ansible_product_name': u'VMware Virtual Platform', u'ansible_all_ipv4_addresses': [u'172.17.101.0', u'172.17.40.1', u'192.168.43.61'], u'ansible_python_version': u'2.7.5', u'ansible_product_version': u'None', u'ansible_service_mgr': u'systemd', u'ansible_memory_mb': {u'real': {u'total': 965, u'used': 895, u'free': 70}, u'swap': {u'cached': 3, u'total': 2047, u'free': 2004, u'used': 43}, u'nocache': {u'used': 556, u'free': 409}}, u'ansible_user_dir': u'/root', u'gather_subset': [u'all'], u'ansible_real_user_id': 0, u'ansible_virtualization_role': u'guest', u'ansible_dns': {u'nameservers': [u'61.139.2.69']}, u'ansible_effective_group_id': 0, u'ansible_lo': {u'features': {u'tx_checksum_ipv4': u'off [fixed]', u'generic_receive_offload': u'on', u'tx_checksum_ipv6': u'off [fixed]', u'tx_scatter_gather_fraglist': u'on [fixed]', u'rx_all': u'off [fixed]', u'highdma': u'on [fixed]', u'rx_fcs': u'off [fixed]', u'tx_lockless': u'on [fixed]', u'tx_tcp_ecn_segmentation': u'on', u'rx_udp_tunnel_port_offload': u'off [fixed]', u'esp_hw_offload': u'off [fixed]', u'tx_gso_robust': u'off [fixed]', u'tx_tcp_mangleid_segmentation': u'on', u'tx_ipxip4_segmentation': u'off [fixed]', u'tx_checksumming': u'on', u'vlan_challenged': u'on [fixed]', u'loopback': u'on [fixed]', u'tx_ipxip6_segmentation': u'off [fixed]', u'fcoe_mtu': u'off [fixed]', u'scatter_gather': u'on', u'tx_checksum_sctp': u'on [fixed]', u'tx_vlan_stag_hw_insert': u'off [fixed]', u'rx_vlan_stag_hw_parse': u'off [fixed]', u'tx_gso_partial': u'off [fixed]', u'rx_vlan_stag_filter': u'off [fixed]', u'large_receive_offload': u'off [fixed]', u'tx_scatter_gather': u'on [fixed]', u'rx_checksumming': u'on [fixed]', u'tx_tcp_segmentation': u'on', u'netns_local': u'on [fixed]', u'tx_esp_segmentation': u'off [fixed]', u'generic_segmentation_offload': u'on', u'tx_udp_tnl_segmentation': u'off [fixed]', u'tcp_segmentation_offload': u'on', u'l2_fwd_offload': u'off [fixed]', u'rx_vlan_offload': u'off [fixed]', u'ntuple_filters': u'off [fixed]', u'tx_gre_csum_segmentation': u'off [fixed]', u'esp_tx_csum_hw_offload': u'off [fixed]', u'tx_tcp6_segmentation': u'on', u'tx_udp_tnl_csum_segmentation': u'off [fixed]', u'udp_fragmentation_offload': u'off', u'tx_sctp_segmentation': u'on', u'tx_checksum_fcoe_crc': u'off [fixed]', u'hw_tc_offload': u'off [fixed]', u'tx_checksum_ip_generic': u'on [fixed]', u'tx_fcoe_segmentation': u'off [fixed]', u'tx_nocache_copy': u'off [fixed]', u'rx_vlan_filter': u'off [fixed]', u'tx_vlan_offload': u'off [fixed]', u'receive_hashing': u'off [fixed]', u'tx_gre_segmentation': u'off [fixed]'}, u'hw_timestamp_filters': [], u'mtu': 65536, u'device': u'lo', u'promisc': False, u'timestamping': [u'tx_software', u'rx_software', u'software'], u'ipv4': {u'broadcast': u'host', u'netmask': u'255.0.0.0', u'network': u'127.0.0.0', u'address': u'127.0.0.1'}, u'ipv6': [{u'scope': u'host', u'prefix': u'128', u'address': u'::1'}], u'active': True, u'type': u'loopback'}, u'ansible_memtotal_mb': 965, u'ansible_device_links': {u'masters': {u'sda2': [u'dm-0', u'dm-1']}, u'labels': {u'sr0': [u'CentOS\\x207\\x20x86_64']}, u'ids': {u'sr0': [u'ata-VMware_Virtual_IDE_CDROM_Drive_10000000000000000001'], u'sda2': [u'lvm-pv-uuid-RsLDcm-lLmP-O6NE-oB4P-4pAY-LfH3-CboMiZ'], u'dm-0': [u'dm-name-centos-root', u'dm-uuid-LVM-TWXGUb0fW1953WmDyJ2OAf0ZBavS6XMSTqH7BlR3Hg97RtWAGlrmnaNLdf0D1h6y'], u'dm-1': [u'dm-name-centos-swap', u'dm-uuid-LVM-TWXGUb0fW1953WmDyJ2OAf0ZBavS6XMS4bRmk8E9RasoU54fwn5t8WisDWCahAem']}, u'uuids': {u'sr0': [u'2017-09-06-10-51-00-00'], u'sda1': [u'b65e3721-d929-4302-b924-db91f598874e'], u'dm-0': [u'8f3c327e-d407-4f58-8d01-b1fa4818f9ca'], u'dm-1': [u'eb49e33c-d0a0-456b-a316-8d7b3b76f361']}}, u'ansible_apparmor': {u'status': u'disabled'}, u'ansible_memfree_mb': 70, u'ansible_processor_count': 1, u'ansible_hostname': u'docker-client2', u'ansible_interfaces': [u'lo', u'flannel.1', u'docker0', u'veth28f26f2', u'ens33'], u'ansible_machine_id': u'b0c456b7231e4d35be8dce2b0b9453b3', u'ansible_fqdn': u'docker-client2', u'ansible_user_gid': 0, u'ansible_nodename': u'docker-client2', u'ansible_lvm': {u'pvs': {u'/dev/sda2': {u'free_g': u'0.00', u'size_g': u'49.00', u'vg': u'centos'}}, u'lvs': {u'root': {u'size_g': u'46.99', u'vg': u'centos'}, u'swap': {u'size_g': u'2.00', u'vg': u'centos'}}, u'vgs': {u'centos': {u'free_g': u'0.00', u'size_g': u'49.00', u'num_lvs': u'2', u'num_pvs': u'1'}}}, u'ansible_domain': u'', u'ansible_distribution_file_path': u'/etc/redhat-release', u'ansible_virtualization_type': u'VMware', u'ansible_ssh_host_key_ed25519_public': u'AAAAC3NzaC1lZDI1NTE5AAAAIAP2V6XMyqgL19nCIoP0RFWfkoQtKY2yodZxYyIfEloP', u'ansible_processor_cores': 2, u'ansible_bios_version': u'6.00', u'ansible_date_time': {u'weekday_number': u'2', u'iso8601_basic_short': u'20180918T164044', u'tz': u'CST', u'weeknumber': u'38', u'hour': u'16', u'year': u'2018', u'minute': u'40', u'tz_offset': u'+0800', u'month': u'09', u'epoch': u'1537260044', u'iso8601_micro': u'2018-09-18T08:40:44.127689Z', u'weekday': u'\u661f\u671f\u4e8c', u'time': u'16:40:44', u'date': u'2018-09-18', u'iso8601': u'2018-09-18T08:40:44Z', u'day': u'18', u'iso8601_basic': u'20180918T164044127602', u'second': u'44'}, u'ansible_distribution_release': u'Core', u'ansible_os_family': u'RedHat', u'ansible_effective_user_id': 0, u'ansible_system': u'Linux', u'ansible_devices': {u'sr0': {u'scheduler_mode': u'deadline', u'rotational': u'1', u'vendor': u'NECVMWar', u'sectors': u'8830976', u'links': {u'masters': [], u'labels': [u'CentOS\\x207\\x20x86_64'], u'ids': [u'ata-VMware_Virtual_IDE_CDROM_Drive_10000000000000000001'], u'uuids': [u'2017-09-06-10-51-00-00']}, u'sas_device_handle': None, u'sas_address': None, u'virtual': 1, u'host': u'IDE interface: Intel Corporation 82371AB/EB/MB PIIX4 IDE (rev 01)', u'sectorsize': u'2048', u'removable': u'1', u'support_discard': u'0', u'model': u'VMware IDE CDR10', u'partitions': {}, u'holders': [], u'size': u'4.21 GB'}, u'sda': {u'scheduler_mode': u'deadline', u'rotational': u'1', u'vendor': u'VMware,', u'sectors': u'104857600', u'links': {u'masters': [], u'labels': [], u'ids': [], u'uuids': []}, u'sas_device_handle': None, u'sas_address': None, u'virtual': 1, u'host': u'SCSI storage controller: LSI Logic / Symbios Logic 53c1030 PCI-X Fusion-MPT Dual Ultra320 SCSI (rev 01)', u'sectorsize': u'512', u'removable': u'0', u'support_discard': u'0', u'model': u'VMware Virtual S', u'partitions': {u'sda2': {u'sectorsize': 512, u'uuid': None, u'links': {u'masters': [u'dm-0', u'dm-1'], u'labels': [], u'ids': [u'lvm-pv-uuid-RsLDcm-lLmP-O6NE-oB4P-4pAY-LfH3-CboMiZ'], u'uuids': []}, u'sectors': u'102758400', u'start': u'2099200', u'holders': [u'centos-swap', u'centos-root'], u'size': u'49.00 GB'}, u'sda1': {u'sectorsize': 512, u'uuid': u'b65e3721-d929-4302-b924-db91f598874e', u'links': {u'masters': [], u'labels': [], u'ids': [], u'uuids': [u'b65e3721-d929-4302-b924-db91f598874e']}, u'sectors': u'2097152', u'start': u'2048', u'holders': [], u'size': u'1.00 GB'}}, u'holders': [], u'size': u'50.00 GB'}, u'dm-0': {u'scheduler_mode': u'', u'rotational': u'1', u'vendor': None, u'sectors': u'98549760', u'links': {u'masters': [], u'labels': [], u'ids': [u'dm-name-centos-root', u'dm-uuid-LVM-TWXGUb0fW1953WmDyJ2OAf0ZBavS6XMSTqH7BlR3Hg97RtWAGlrmnaNLdf0D1h6y'], u'uuids': [u'8f3c327e-d407-4f58-8d01-b1fa4818f9ca']}, u'sas_device_handle': None, u'sas_address': None, u'virtual': 1, u'host': u'', u'sectorsize': u'512', u'removable': u'0', u'support_discard': u'0', u'model': None, u'partitions': {}, u'holders': [], u'size': u'46.99 GB'}, u'dm-1': {u'scheduler_mode': u'', u'rotational': u'1', u'vendor': None, u'sectors': u'4194304', u'links': {u'masters': [], u'labels': [], u'ids': [u'dm-name-centos-swap', u'dm-uuid-LVM-TWXGUb0fW1953WmDyJ2OAf0ZBavS6XMS4bRmk8E9RasoU54fwn5t8WisDWCahAem'], u'uuids': [u'eb49e33c-d0a0-456b-a316-8d7b3b76f361']}, u'sas_device_handle': None, u'sas_address': None, u'virtual': 1, u'host': u'', u'sectorsize': u'512', u'removable': u'0', u'support_discard': u'0', u'model': None, u'partitions': {}, u'holders': [], u'size': u'2.00 GB'}}, u'ansible_user_uid': 0, u'ansible_bios_date': u'07/02/2015', u'ansible_veth28f26f2': {u'macaddress': u'ee:43:48:1b:1b:d0', u'features': {u'tx_checksum_ipv4': u'off [fixed]', u'generic_receive_offload': u'on', u'tx_checksum_ipv6': u'off [fixed]', u'tx_scatter_gather_fraglist': u'on', u'rx_all': u'off [fixed]', u'highdma': u'on', u'rx_fcs': u'off [fixed]', u'tx_lockless': u'on [fixed]', u'tx_tcp_ecn_segmentation': u'on', u'rx_udp_tunnel_port_offload': u'off [fixed]', u'esp_hw_offload': u'off [fixed]', u'tx_gso_robust': u'off [fixed]', u'tx_tcp_mangleid_segmentation': u'on', u'tx_ipxip4_segmentation': u'on', u'tx_checksumming': u'on', u'vlan_challenged': u'off [fixed]', u'loopback': u'off [fixed]', u'tx_ipxip6_segmentation': u'on', u'fcoe_mtu': u'off [fixed]', u'scatter_gather': u'on', u'tx_checksum_sctp': u'on', u'tx_vlan_stag_hw_insert': u'on', u'rx_vlan_stag_hw_parse': u'on', u'tx_gso_partial': u'off [fixed]', u'rx_vlan_stag_filter': u'off [fixed]', u'large_receive_offload': u'off [fixed]', u'tx_scatter_gather': u'on', u'rx_checksumming': u'on', u'tx_tcp_segmentation': u'on', u'netns_local': u'off [fixed]', u'tx_esp_segmentation': u'off [fixed]', u'generic_segmentation_offload': u'on', u'tx_udp_tnl_segmentation': u'on', u'tcp_segmentation_offload': u'on', u'l2_fwd_offload': u'off [fixed]', u'rx_vlan_offload': u'on', u'ntuple_filters': u'off [fixed]', u'tx_gre_csum_segmentation': u'on', u'esp_tx_csum_hw_offload': u'off [fixed]', u'tx_tcp6_segmentation': u'on', u'tx_udp_tnl_csum_segmentation': u'on', u'udp_fragmentation_offload': u'off', u'tx_sctp_segmentation': u'on', u'tx_checksum_fcoe_crc': u'off [fixed]', u'hw_tc_offload': u'off [fixed]', u'tx_checksum_ip_generic': u'on', u'tx_fcoe_segmentation': u'off [fixed]', u'tx_nocache_copy': u'off', u'rx_vlan_filter': u'off [fixed]', u'tx_vlan_offload': u'on', u'receive_hashing': u'off [fixed]', u'tx_gre_segmentation': u'on'}, u'type': u'ether', u'hw_timestamp_filters': [], u'mtu': 1500, u'device': u'veth28f26f2', u'promisc': True, u'timestamping': [u'rx_software', u'software'], u'ipv6': [{u'scope': u'link', u'prefix': u'64', u'address': u'fe80::ec43:48ff:fe1b:1bd0'}], u'active': True, u'speed': 10000}, u'ansible_system_capabilities': [u'cap_chown', u'cap_dac_override', u'cap_dac_read_search', u'cap_fowner', u'cap_fsetid', u'cap_kill', u'cap_setgid', u'cap_setuid', u'cap_setpcap', u'cap_linux_immutable', u'cap_net_bind_service', u'cap_net_broadcast', u'cap_net_admin', u'cap_net_raw', u'cap_ipc_lock', u'cap_ipc_owner', u'cap_sys_module', u'cap_sys_rawio', u'cap_sys_chroot', u'cap_sys_ptrace', u'cap_sys_pacct', u'cap_sys_admin', u'cap_sys_boot', u'cap_sys_nice', u'cap_sys_resource', u'cap_sys_time', u'cap_sys_tty_config', u'cap_mknod', u'cap_lease', u'cap_audit_write', u'cap_audit_control', u'cap_setfcap', u'cap_mac_override', u'cap_mac_admin', u'cap_syslog', u'35', u'36', u'37+ep']}}}, u'unreachable': {}}
        # d2={'zhang':{'sex':'man'}}
        return render(request, "index.html",{"result": d1})

    def post(self, request, *args, **kwargs):
        resource = []
        results = request.data.dict()
        for k, v in results.items():
            if v == "":
                results.pop(k)
        if results.get("hostname"):
            pass
        elif results.get("ip"):
            results['hostname']=results.get("ip")
        else:
            # print "必须有hostname,或者IP地址"
            return render(request, "index.html", {"result": "必须填写IP,HOSTNAME"})
        print results
        resource.append(results)
        rbt=ANSRunner(resource)
        rbt.run_model(host_list=results.get("ip"), module_name='setup',module_args="filter=*")
        result=rbt.get_model_result()
        import json
        result=json.loads(result)
        print result

        return render(request, "index.html", {"result": result})
